package application

import (
   {{range .ControllerNames}}
  "{{$.PackagePath}}/domain_{{$.DomainName}}/controller/{{LowerCase .}}"{{end}} {{range .GatewayNames}}
  "{{$.PackagePath}}/domain_{{$.DomainName}}/gateway/{{LowerCase .}}" {{end}}{{range .UsecaseNames}}
  "{{$.PackagePath}}/domain_{{$.DomainName}}/usecase/{{SnakeCase .}}" {{end}}
  "{{.PackagePath}}/shared/lazygo"
  "{{.PackagePath}}/shared/config"
  "{{.PackagePath}}/shared/infrastructure/logger"
  "{{.PackagePath}}/shared/infrastructure/token"
)

type {{CamelCase .ApplicationName}} struct {}

func New{{PascalCase .ApplicationName}}() lazygo.Runner {
	return &{{CamelCase .ApplicationName}}{}
}

func ({{CamelCase .ApplicationName}}) Run() error {

	const appName = "{{CamelCase .ApplicationName}}"

	cfg := config.ReadConfig()

	appData := lazygo.NewApplicationData(appName)

	log := logger.NewZapLogger(appData, cfg)

	jwtToken := token.NewJWTToken(cfg.JWTSecretKey)
	{{range .GatewayNames}}
	{{CamelCase .}}datasource := {{LowerCase .}}.NewGateway(log, appData, cfg){{end}}
	{{range .ControllerNames}}
	{{CamelCase .}}Driver := {{LowerCase .}}.NewController(appData, log, cfg, jwtToken)

	{{CamelCase .}}.AddUsecase(
	    {{range $.UsecaseNames}}
		{{RemoveSnakeCase . }}.NewUsecase(datasource, log),{{end}}
	){{end}}
	{{range .ControllerNames}}
	{{CamelCase .}}Driver.RegisterRouter()
	{{CamelCase .}}.Start(){{end}}

	return nil
}
